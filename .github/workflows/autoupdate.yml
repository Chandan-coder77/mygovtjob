name: Auto Update Jobs

on:
  schedule:
    - cron: "0 */6 * * *"   # ‚è≥ Har 6 ghante auto run
  workflow_dispatch:        # ‚ñ∂ Manual run

jobs:
  scrape_and_train:
    runs-on: ubuntu-latest

    steps:

    # ===============================
    # Step-0: Pull Repository
    # ===============================
    - name: Pull Repository
      uses: actions/checkout@v3

    # ===============================
    # Step-1: Python Setup
    # ===============================
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.10"

    # ===============================
    # Step-2: Install Dependencies
    # ===============================
    - name: Install Dependencies
      run: |
        pip install requests beautifulsoup4 pdfminer.six lxml

    # ===============================
    # Step-3: Run MASTER JOB ENGINE
    # (single source of truth)
    # ===============================
    - name: Run Master Job Engine
      env:
        HF_API_KEY: ${{ secrets.HF_API_KEY }}
      run: python master_job_engine.py

    # ===============================
    # üî• Step-4: SAFE Commit & Push (SOLUTION-B)
    # No conflict, future-proof
    # ===============================
    - name: Commit & Push Results (Safe)
      run: |
        git config --global user.name "GitHub AI Bot"
        git config --global user.email "actions@github.com"

        # üîÑ Always sync with remote first
        git fetch origin
        git reset --hard origin/main

        # üì¶ Commit latest generated files
        git add -A
        git commit -m "Auto Update via Master Job Engine ü§ñ" || echo "No changes to commit"

        # üöÄ Force push safely
        git push origin main --force
