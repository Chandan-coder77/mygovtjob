name: Auto Update Jobs

on:
  schedule:
    - cron: "0 */6 * * *"   # Har 6 ghante auto run
  workflow_dispatch:

jobs:
  scrape_and_train:
    runs-on: ubuntu-latest

    steps:
      # ===============================
      # Step-0: Pull Repository
      # ===============================
      - name: Pull Repository
        uses: actions/checkout@v3

      # ===============================
      # Step-1: Python Setup
      # ===============================
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      # ===============================
      # Step-2: Install Dependencies
      # ===============================
      - name: Install Dependencies
        run: |
          pip install requests beautifulsoup4 pdfminer.six lxml

      # ===============================
      # Step-3: Raw Scraper (A5A.1)
      # ===============================
      - name: Run Scraper
        run: python scraper_detail.py

      # ===============================
      # Step-4: Job Intelligence Filter (A5.2)
      # ===============================
      - name: Run Job Intelligence Filter
        run: python job_intelligence_filter.py

      # ===============================
      # Step-5: Autopilot Master
      # ===============================
      - name: Run Autopilot Master
        run: python autopilot_master.py

      # ===============================
      # Step-5.5: Job Sanity Corrector
      # ===============================
      - name: Run Job Sanity Corrector
        run: python job_sanity_corrector.py

      # ===============================
      # Step-5.7: Job Detail Extractor
      # ===============================
      - name: Run Job Detail Extractor
        run: python job_detail_extractor.py

      # ===============================
      # Step-5.8: Job Field Sanity v2
      # ===============================
      - name: Run Job Field Sanity v2
        run: python job_field_sanity_v2.py

      # ===============================
      # Step-5.9: Global Deduplicator
      # ===============================
      - name: Run Global Job Deduplicator
        run: python job_global_deduplicator.py

      # ===============================
      # Step-6.1: Job Validity Gate
      # ===============================
      - name: Run Job Validity Gate
        run: python job_validity_gate.py

      # =====================================================
      # ðŸ”¹ Step-6.9: MASTER JOB ENGINE v1
      # Rule + PDF + Basic AI Assist
      # =====================================================
      - name: Run Master Job Engine v1
        env:
          HF_API_KEY: ${{ secrets.HF_API_KEY }}
        run: python master_job_engine.py

      # =====================================================
      # ðŸ”¹ Step-7: MASTER JOB ENGINE v2
      # Full page read + HF Q/A
      # =====================================================
      - name: Run Master Job Engine v2 (Deep Accuracy)
        env:
          HF_API_KEY: ${{ secrets.HF_API_KEY }}
        run: python master_job_engine_v2.py

      # =====================================================
      # ðŸ”¥ðŸ”¥ Step-8: MASTER JOB ENGINE v3 (FINAL BRAIN)
      # - Full semantic understanding
      # - Sentence based extraction
      # - Job title + age + salary + date + vacancy
      # - Uses ChatAnywhere / OpenAI compatible API
      # - 200 calls/day safe
      # =====================================================
      - name: Run Master Job Engine v3 (Semantic AI)
        env:
          AI_LLM_API_KEY: ${{ secrets.AI_LLM_API_KEY }}
        run: python master_job_engine_v3.py

      # ===============================
      # Step-9: AI Trainer
      # ===============================
      - name: Train AI Memory
        run: python ai_trainer.py

      # ===============================
      # Step-10: AI Corrector
      # ===============================
      - name: AI Corrector Smart Update
        run: python ai_corrector_v2.py

      # ===============================
      # Step-11: Clean Memory
      # ===============================
      - name: Clean & Compress AI Memory
        run: python clean_memory.py

      # ===============================
      # Step-12: Auto Backup
      # ===============================
      - name: Auto Backup
        run: |
          mkdir -p backup
          cp ai_memory.json backup/ai_memory_$(date +'%d-%m-%Y_%H-%M-%S').json || echo "Backup skipped"

      # ===============================
      # Step-13: Commit & Push
      # ===============================
      - name: Commit & Push Results
        run: |
          git config --global user.name "GitHub AI Bot"
          git config --global user.email "actions@github.com"
          git add -A
          git commit -m "Auto Update Jobs + Master Engine v3 Semantic AI ðŸš€" || echo "No changes"
          git push --force
